<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Индивидуальный проект</title>
  <style>
    body{font-family:Arial, sans-serif;background:#f0f4f8;display:flex;justify-content:center;align-items:center;min-height:100vh;margin:0}
    .container{background:#fff;padding:30px 40px;border-radius:12px;box-shadow:0 10px 25px rgba(0,0,0,.1);width:100%;max-width:500px;position:relative}
    h1{text-align:center;margin-bottom:25px;color:#333}
    label{display:block;margin-bottom:6px;font-weight:bold;color:#555}
    input,textarea{width:100%;padding:12px 15px;margin-bottom:15px;border-radius:8px;border:1px solid #ccc;font-size:16px}
    button{width:100%;padding:14px;background:#4A90E2;color:#fff;font-size:16px;border:none;border-radius:8px;cursor:pointer;transition:background .3s}
    button:hover{background:#357ABD}
    .success{display:none;text-align:center;margin-bottom:15px;color:green;font-weight:bold}
    .back-button{position:absolute;top:15px;left:15px;padding:6px 12px;background:#ccc;border-radius:6px;text-decoration:none;color:#333;font-weight:bold;transition:background .3s}
    .back-button:hover{background:#bbb}
  </style>
</head>
<body>
  <div class="container">
    <a href="index.html" class="back-button">← Главная</a>
    <h1>Индивидуальный проект</h1>
    <div class="success" id="successMessage">Заявка отправлена! После подтверждения с вами свяжутся.</div>

    <form id="projectForm">
      <label for="name">Имя</label>
      <input id="name" type="text" required />

      <label for="projectTopic">Тема проекта</label>
      <input id="projectTopic" type="text" required />

      <label for="deadline">Дедлайн</label>
      <input id="deadline" type="date" required />

      <label for="wishes">Дополнительные пожелания</label>
      <textarea id="wishes" rows="3"></textarea>

      <label for="contacts">Контакты</label>
      <input id="contacts" type="text" required />

      <button type="submit">Оставить заявку</button>
    </form>
  </div>

  <script>
    const form = document.getElementById('projectForm');
    const successMessage = document.getElementById('successMessage');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const data = {
        name: document.getElementById('name').value,
        projectTopic: document.getElementById('projectTopic').value,
        deadline: document.getElementById('deadline').value,
        wishes: document.getElementById('wishes').value,
        contacts: document.getElementById('contacts').value,
        date: new Date().toISOString().split('T')[0]
      };

      try {
        const res = await fetch("https://studentus-server.onrender.com/add-project", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });
        const result = await res.json();

        if (result.success) {
          successMessage.style.display = 'block';
          setTimeout(() => {
            if (window.Telegram && window.Telegram.WebApp) {
              window.Telegram.WebApp.close();
            } else {
              form.reset();
              successMessage.style.display = 'none';
            }
          }, 2000);
        } else {
          alert("Ошибка при отправке: " + (result.message || "неизвестная ошибка") + (result.details ? "\n" + result.details : ""));
        }
      } catch (err) {
        console.error(err);
        alert("Ошибка соединения. Проверьте интернет и попробуйте снова.");
      }
    });
  </script>
</body>
</html>
